# 日本花火シミュレーション（Processing × Java）

## 概要

日本の伝統的な打ち上げ花火（丸割物・和風色）をProcessing(Java)でリアルに再現するシミュレーションです。
- **和風カラーパレット**・**球状爆発**・**残像エフェクト**を実装
- Maven＋JitPackで依存解決、誰でもcloneして即ビルド＆実行可能
- 設計・進捗・技術仕様もすべてMarkdownでドキュメント化

## 実行方法

### 方法1: 直接実行（推奨）
1. 必要環境: Java 17以上
2. clone後、以下を実行

```bash
# コンパイル
javac -cp "lib/processing-core.jar" -d target/classes src/main/java/fireworks/*.java

# 実行
java -cp "lib/processing-core.jar:target/classes" fireworks.PMainFireworks
```

### 方法2: Maven（要Maven環境）
```bash
mvn compile exec:java
```

- フルスクリーンで日本花火が自動生成されます

## ディレクトリ構成

```
fireworks/
├── pom.xml
├── .gitignore
├── README.md
├── LICENSE
├── docs/         # 設計・仕様・進捗ドキュメント
├── src/main/java/fireworks/
│   ├── Particle.java
│   ├── Firework.java
│   └── PMainFireworks.java
└── ...
```

## ブランチ構成

### main（ドキュメント専用）
- プロジェクト概要・README・ライセンス
- 全体設計書・技術仕様書
- ブランチ戦略の説明

### ubuntu-port（Ubuntu/WSL開発）
- **v2.0 Wind System**: 最新の風物理システム
- Ubuntu/WSL環境での開発・テスト
- 高度な物理モデル・プロ仕様の風制御

### win11（Windows開発）
- **v1.9 Debug Display**: 基本システム＋デバッグ最適化
- Windows環境での安定動作
- 基本的な花火シミュレーション機能

## 参考ドキュメント
- `docs/wind_system_design_v2.0.md`：v2.0風システム技術設計書
- `docs/hanabi_design_v_1.md`：日本花火デザイン仕様
- `docs/AI_AGENT_TECHNICAL_SPECIFICATION.md`：AI向け技術設計書
- `docs/fireworks_simulation.md`：シミュレーション全体設計
- `docs/PROGRESS_LOG.md`：開発進捗履歴

## ライセンス
MIT License 

## バージョン履歴

### v2.1+ 日本伝統花火ラインナップ（現在 - ubuntu-port branch）
- **🎨 10種類の花火パターン**: 1-9,0キーで切り替え
- **🎯 日本伝統花火追加**: 8=赤丸割物、9=牡丹、0=千輪菊
- **🔄 複合花火システム**: 千輪菊は12個のミニ花火が連鎖爆発
- **🎨 色彩自動設定**: パターンごとに伝統的な色彩を自動適用
- **⚙️ 未来予測と逆算ロジック**: 重力の影響を予測して美しい形状を維持

### v2.0 Wind System
- **風演算システム実装**: 現実的な風物理モデル
- **矢印キー制御**: ←→方向、↑↓強度、T=ON/OFF
- **高度効果**: 高度による風強度変化（tanh関数使用）
- **サイズ抵抗**: パーティクル表面積/質量比による物理的風抵抗
- **気象情報表示**: 具体的風速（m/s）・気象学的分類表示
- **プロ仕様**: 花火師レベルの風速・風向き情報

### v1.9 Debug Display Optimization（win11 branch）
- デバッグ情報の半透明化・視認性最適化
- 明るい緑色テキスト・薄い背景で花火表示を邪魔しない設計

### v1.8 Pattern Control
- パターン制御機能（1-4キーで花火形状切替）
- RANDOM/RING/LINE/STAR形状対応

### v1.6 Star-Mine Mode
- スターマインモード（連続クリック→一斉打ち上げ）
- 闇の演出効果付き

### v1.1（2024-06-08）
- 火花の速度分布を平方根分布に変更（中心密度UP）
- Particleの寿命減衰を指数関数的減衰に変更（より自然な消え方）
- 点滅・光量ブレ（アルファ値やサイズの揺らぎ）を追加
- 残像効果のalpha値を定数化し、調整しやすく

### v1.0
- 丸割物（球状）花火＋和風カラーパレット
- 基本物理モデル（重力・残像）
- Maven/JitPackビルド
- ドキュメント・進捗管理

## 物理モデル仕様（v1.5以降）

- クリック花火・自動花火ともに「目標高度（Y座標）」で爆発
- 打ち上げ初速vyは「目標高度に理論的に到達する値」を厳密に計算（ランダム誤差なし）
- 縦軸のランダム性は「目標高度の選択」のみ（自動花火はランダム、クリック花火はユーザー指定）
- 今後は風の演算で横軸（vx）に自然なズレを加える予定

### 操作方法

#### 🎯 花火パターン切り替え（10種類）
- **1-7キー**: 基本パターン
  - 1=丸割物 2=正円 3=直線 4=星 5=菊 6=柳 7=椰子
- **8,9,0キー**: 日本伝統花火 ⭐NEW!
  - 8=赤色の丸割物 9=牡丹 0=千輪菊（連鎖爆発）

#### 🎮 基本操作
- **マウスクリック**: スターマインモード（連続クリック→0.5秒待機→一斉打ち上げ）
- **スペースキー**: 中央下部からランダム花火を1発打ち上げ
- **Rキー**: 全花火クリア
- **Dキー**: デバッグ情報表示切替

#### 🌬️ 風制御システム
- **←→キー**: 風向き制御（左風・右風）
- **↑↓キー**: 風強度制御（強く・弱く）
- **Tキー**: 風のON/OFF切替

### 設計思想・拡張性
- 物理モデルを厳密化することで、今後「風」「多段爆発」「形状バリエーション」などの拡張が容易
- コード・設計の再現性と保守性を重視 