# AIエージェント（Claude）向け開発・運用マニュアル

このドキュメントは、AIエージェント（Claude）が「日本花火シミュレーション」プロジェクトで開発作業を行う際の、**行動規範、作業手順、および安全規則**を定義するものです。エージェントは、このマニュアルに記載されたルールを**厳格に遵守**し、高品質で安全な開発を遂行してください。

---

## 📌 プロジェクト概要

本プロジェクトは OSごとにブランチが分かれています：

- `main`: 参照専用（README, CLAUDE.md, docs/）
- `win11`: Windows向け実装（v1.6まで）
- `ubuntu-port`: Ubuntu/WSL + Claude協調開発（v2.0以降）

Claudeが作業してよいのは `ubuntu-port` のみです。

---

## 🧭 ブランチ構成とClaudeの作業許可

| ブランチ       | 用途                                | Claudeの作業 |
|----------------|-------------------------------------|---------------|
| `main`         | 共通ドキュメント・参照専用           | ❌ 禁止        |
| `win11`        | Windows向け手動開発（v1.6まで）       | ❌ 禁止        |
| `ubuntu-port`  | Ubuntu/WSL + Claude開発（v2.0以降）   | ✅ 許可        |

---

## 🛑 Claudeによる自動操作の禁止事項

### ❌ Git操作に関する禁止事項

Claudeは以下の操作を**提案・実行してはならない**：

- `main`, `win11` ブランチへの `add`, `commit`, `push`
- `git rebase`, `git reset`, `git checkout`, `git push --force`
- `rm -rf` による削除操作（人間の許可がない限り）
- `.gitignore` に未登録のファイルを削除対象とすること

> 🔍 **例外**: `ubuntu-port` 上での軽微なコミットと `push` は許可されます

---

## ✅ Claudeが許可される操作（ubuntu-port 限定）

| 操作項目            | 許可 | 条件                                      |
|---------------------|------|-------------------------------------------|
| Git Push            | ✅   | `ubuntu-port` のみ                        |
| Rebase              | ❌   | 使用禁止                                  |
| Reset               | ❌   | 使用禁止                                  |
| `rm -rf`            | ❌   | 手動確認必須（`.Zone.Identifier` も含む） |
| `.gitignore`編集   | ✅   | 提案のみ。自動コミットは不可              |
| コード編集          | ✅   | 明示されたファイルに限る                  |
| MCPログ出力        | ✅   | `mcp.log` に保存。標準出力は避ける        |

---

## 🧠 Claudeがセッションごとに行うべきこと

1. `git branch` で作業ブランチを確認
2. `git remote -v` でリモート設定を確認
3. `git log --oneline -3` で履歴の文脈を把握
4. `docs/PROGRESS_LOG.md` を必ず読み・追記
5. `.gitignore` に未登録のファイルは**削除せず**保留し、人間に確認を仰ぐ

---

## 📂 Claudeが残すべきファイル

- `docs/PROGRESS_LOG.md`：セッションの記録・未完タスク
- `CLAUDE.md`：本ドキュメント（行動規範・ルール）
- `mcp.log`：Claude実行中のMCPログ
- その他、セッション中に生成された設計・検討用ファイル

---

## 🚫 Claudeが削除してはならないファイル・ディレクトリ

| 種別          | 例                                                      |
|---------------|----------------------------------------------------------|
| 実行環境依存  | `jdk-*`, `apache-maven-*`, `project*`, `target*/`       |
| ソースコード  | `SolarSystem*`, `SuikaGame*`                             |
| バイナリ類    | `*.tar.gz`, `*.cmd`, `*.conf`, `*.Zone.Identifier`       |
| その他        | `.gitignore` に未登録の構成ファイル・ログ類すべて       |

> ❗ `.Zone.Identifier` や `.DS_Store` 等も**削除は明示許可が必要**です

---

## 🗂 現在の作業状況（Claude記入）

- [x] v1.6: スターマインモード（win11）
- [x] v1.9: デバッグ表示最適化（ubuntu-port）
- [x] v2.0: Wind System（ubuntu-port）
- [ ] v2.1: 花火形状の拡張（予定）

---

## 📜 基本原則：セッション継続性の確保

- Claudeの作業履歴がこのプロジェクトの「記憶」です。
- すべてのセッション開始時・終了時に `docs/PROGRESS_LOG.md` を更新してください。
- 実装上の選択や思考の理由もなるべく簡潔に記録してください。

---

## 📘 セッション手順

### セッション開始前
- `git branch`, `git log`, `docs/PROGRESS_LOG.md` を確認
- 前回の未完タスクを洗い出し、今回のタスク計画を立てる

### 作業中
- 設計上の判断、実装上の難所、解決策は `PROGRESS_LOG.md` にその都度記録
- 不明点や予期せぬ挙動があれば、作業を一時停止し人間に報告

### セッション終了時
- 完了タスク・未完タスクを明記
- 作業内容を Markdown フォーマットで記録
- push 前にログが最新であることを確認

```markdown
### 📅 日付：YYYY-MM-DD
#### 🚀 本日のゴール
- （例：スターマイン・モードの実装）

#### ✅ 完了タスク
- [x] `Firework.java` に時間指定爆発を追加

#### 🐛 問題と解決策
- 問題：`vx` の初期値が風の影響を受けていなかった
- 解決：WindSystem.java の `getWindVector()` を初期化時に参照

#### 📝 次回タスク
- [ ] `風` と `重力` の合成ベクトルによる曲線軌道
- [ ] 拡張花火「柳」の実装
```

---

## 🔍 CLAUDE.mdの目的と効果

| 項目               | 効果                            |
| ---------------- | ----------------------------- |
| ブランチ誤操作の防止       | `ubuntu-port` 限定によって他ブランチを保護  |
| 危険操作の明文化         | `rebase`, `reset`, `rm` を全面禁止 |
| ファイル保護           | 環境・ソース依存の重要ファイルを削除から防御        |
| セッション記録の徹底       | セッション再現性・デバッグ可能性の向上           |
| Claudeの行動制限と文脈維持 | 再起動時にも同じ基準で動作・説明が可能           |

---

**あなたの役割は、安全かつ着実にプロジェクトを進化させることです。不明な点やリスクのある操作については、必ず人間に判断を仰いでください。**